task :default => [:ci, :jci, :bench]

task :bench => [:benchmarks]
task :benchmarks do
  paths = Dir['test/**/*_benchmark.rb']
  paths.each do |path| 
    ruby path
    puts ""
  end
end

task :ci do
  sh 'spec spec'
end

task :jci do
  unless (which_jruby = `which jruby`).empty?
    jruby_bin_dir = File.dirname(which_jruby)
    sh "#{jruby_bin_dir}/spec spec"
  else
    puts "jruby was not found in PATH (`which jruby` gives nothing)"
  end
end

STATS_DIRECTORIES = [
  %w(Code        lib),
  %w(Specs       spec)
].collect { |name, dir| [ name, "#{File.dirname(__FILE__)}/#{dir}" ] }.select { |name, dir| File.directory?(dir) }

desc "Report code statistics (KLOCs, etc) from the application"
task :stats do
  require 'code_statistics'
  CodeStatistics.const_set(:TEST_TYPES,%w(Specs))
  CodeStatistics.new(*STATS_DIRECTORIES).to_s
end
